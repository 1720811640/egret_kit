var egret=window.egret,__reflect=this&&this.__reflect||function(e,t,n){e.__class__=t,n?n.push(t):n=[t],e.__types__=e.__types__?n.concat(e.__types__):n},__awaiter=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function a(e){try{c(r.next(e))}catch(t){o(t)}}function s(e){try{c(r["throw"](e))}catch(t){o(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(a,s)}c((r=r.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function n(e){return function(t){return r([e,t])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;c;)try{if(i=1,o&&(a=o[2&n[0]?"return":n[0]?"throw":"next"])&&!(a=a.call(o,n[1])).done)return a;switch(o=0,a&&(n=[0,a.value]),n[0]){case 0:case 1:a=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,o=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(a=c.trys,!(a=a.length>0&&a[a.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){c.label=n[1];break}if(6===n[0]&&c.label<a[1]){c.label=a[1],a=n;break}if(a&&c.label<a[2]){c.label=a[2],c.ops.push(n);break}a[2]&&c.ops.pop(),c.trys.pop();continue}n=t.call(e,c)}catch(r){n=[6,r],o=0}finally{i=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,o,a,s,c={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:n(0),"throw":n(1),"return":n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},__extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);n.prototype=t.prototype,e.prototype=new n},WxPlatform=function(){function e(){this.name="wxgame",this.header={}}return e.prototype.getFriendCloudStorage=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,new Promise(function(e,t){wx.getFriendCloudStorage({keyList:["socre","date"],success:function(t){console.log(t),e(t)},fail:function(e){t(e)}})})]})})},e.prototype.getGroupCloudStorage=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,new Promise(function(t,n){wx.getGroupCloudStorage({keyList:["score","date"],success:function(e){var n=new Array;e.data&&0!=e.data.length&&(e.data.forEach(function(e,t){var r=Utils.transObj(e.KVDataList);Utils.isInTimeRange(r.date)&&n.push({score:parseInt(r.score),date:r.date||"",openId:e.openid,user:{nickname:e.nickname,avatar_url:e.avatarUrl}})}),n.sort(function(e,t){var n=e.score,r=t.score;return r-n})),t(n)},fail:function(e){n(e)},complete:function(e){},shareTicket:e})})]})})},e.prototype.setKVData=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,new Promise(function(t,n){var r=[];for(var i in e)r.push({key:i,value:e[i]});wx.setUserCloudStorage({KVDataList:r,success:function(e){t(e)},fail:function(e){n(e)}})})]})})},e.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,new Promise(function(e,t){wx.showLoading({title:"游戏加载中...",mask:!0}),wx.login({success:function(t){e(t)},fail:function(e){t(e)}})})]})})},e.prototype.auth=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r=this;return __generator(this,function(i){return[2,new Promise(function(i,o){var a={js_code:e,iv:t,encrypted_data:n},s=r;wx.request({url:Api.loginPath,method:"POST",data:a,success:function(e){s.header={Authorization:e.data.token},wx.hideLoading(),i(e)},fail:function(e){o(e)}})})]})})},e.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,new Promise(function(e,t){wx.getUserInfo({success:function(t){var n=t.userInfo;n.nickName,n.avatarUrl,n.gender,n.province,n.city,n.country;n.encryptedData=t.encryptedData,n.iv=t.iv,e(n)},fail:function(e){t(e)}})})]})})},e.prototype.showAuthModal=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return wx.hideLoading(),[2,new Promise(function(e,t){wx.showModal({title:"提示",content:"请您进行登陆授权",showCancel:!1,cancelText:"",confirmText:"去授权",success:function(n){wx.openSetting({success:function(t){e(t)},fail:function(e){t(e)}})}})})]})})},e}();__reflect(WxPlatform.prototype,"WxPlatform",["Platform"]),window.platform||(window.platform=new WxPlatform);var GameConfig=function(){function e(){}return e.getBasicUrl=function(){return this.basicUrl},e.getAppCode=function(){return this.appCode},e.getVersion=function(){return this.version},e.getShareTitle=function(){return this.shareTitle},e.getShareImg=function(){return this.shareImg},e.setStageWidthHeight=function(e){this.stageWidth=e.stageWidth,this.stageHeight=e.stageHeight},e.getWidth=function(){return this.stageWidth},e.getHeight=function(){return this.stageHeight},e.getKey=function(){return this.key},e.setMain=function(e){this.stage=e},e.getMain=function(){return this.stage},e.basicUrl="",e.appCode=1,e.version="1.0.0",e.shareTitle="分享标题",e.shareImg="imgUrl",e.stageWidth=0,e.stageHeight=0,e.key="",e.stage=null,e}();__reflect(GameConfig.prototype,"GameConfig");var Utils=function(){function e(){}return e.getNowDate=function(){return this.dateFtt(new Date,"yyyy-MM-dd hh:mm:ss")},e.getWeekTime=function(){var t=new Date,n=t.getFullYear(),r=t.getMonth(),i=t.getDate(),o=t.getDay(),a=new Date(n,r,i-(o?o-1:6)),s=new Date(n,r,i+(o?8-o:1));return e.dateRange=[this.dateFtt(a),this.dateFtt(s)],e.dateRange},e.isInTimeRange=function(e){if(e){var t=new Date(e.replace(/-/g,"/")).getTime();return t>this.dateRange[0]&&t<this.dateRange[1]}return!1},e.transObj=function(e){var t={};return e.map(function(e){t[e.key]=e.value}),t},e.dateFtt=function(e,t){var n={"M+":e.getMonth()+1,"d+":e.getDate(),"h+":e.getHours(),"m+":e.getMinutes(),"s+":e.getSeconds(),"q+":Math.floor((e.getMonth()+3)/3),S:e.getMilliseconds()};t||(t="yyyy-MM-ddThh:mm:ss+00:00"),/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(e.getFullYear()+"").substr(4-RegExp.$1.length)));for(var r in n)new RegExp("("+r+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?n[r]:("00"+n[r]).substr((""+n[r]).length)));return t},e.dateRange=[],e}();__reflect(Utils.prototype,"Utils");var eKit=function(){function e(){}return e.createSprite=function(e){var t=new egret.Sprite;if(e)for(var n in e)t[n]=e[n];return t},e.createBitmapByName=function(e,t){var n=new egret.Bitmap,r=RES.getRes(e);if(n.texture=r,t)for(var i in t)n[i]=t[i];return n},e.createText=function(e,t){var n=new egret.TextField;if(n.text=e,t)for(var r in t)n[r]=t[r];return n},e.createAvatar=function(e,t){return void 0===e&&(e=""),__awaiter(this,void 0,void 0,function(){var n=this;return __generator(this,function(r){return[2,new Promise(function(r,i){e||i("无头像"),RES.getResByUrl(e,function(e){var n=e,i=new egret.Bitmap(n);if(t)for(var o in t)i[o]=t[o];r(i)},n,RES.ResourceItem.TYPE_IMAGE)})]})})},e.createLine=function(e,t,n){var r=new egret.Shape;if(t.beginFill&&r.graphics.beginFill(t.beginFill.color,t.beginFill.alpha),t.lineStyle&&r.graphics.lineStyle(t.lineStyle.thickness,t.lineStyle.color,t.lineStyle.alpha,t.lineStyle.pixelHinting,t.lineStyle.scaleMode,t.lineStyle.caps,t.lineStyle.joints,t.lineStyle.miterLimit),r.graphics.moveTo(e[0][0],e[0][1]),e.map(function(t,n){n>0&&r.graphics.lineTo(e[n][0],e[n][1])}),r.graphics.endFill(),n)for(var i in n)r[i]=n[i];return r},e.createRect=function(e,t,n){var r=new egret.Shape;if(t.beginFill&&r.graphics.beginFill(t.beginFill.color,t.beginFill.alpha),t.lineStyle&&r.graphics.lineStyle(t.lineStyle.thickness,t.lineStyle.color,t.lineStyle.alpha,t.lineStyle.pixelHinting,t.lineStyle.scaleMode,t.lineStyle.caps,t.lineStyle.joints,t.lineStyle.miterLimit),r.graphics.drawRect(e[0],e[1],e[2],e[3]),n)for(var i in n)r[i]=n[i];return r},e.createCircle=function(e,t,n){var r=new egret.Shape;if(t.beginFill&&r.graphics.beginFill(t.beginFill.color,t.beginFill.alpha),t.lineStyle&&r.graphics.lineStyle(t.lineStyle.thickness,t.lineStyle.color,t.lineStyle.alpha,t.lineStyle.pixelHinting,t.lineStyle.scaleMode,t.lineStyle.caps,t.lineStyle.joints,t.lineStyle.miterLimit),r.graphics.drawCircle(e[0],e[1],e[2]),n)for(var i in n)r[i]=n[i];return r},e.createArc=function(e,t,n){var r=new egret.Shape;if(t.beginFill&&r.graphics.beginFill(t.beginFill.color,t.beginFill.alpha),t.lineStyle&&r.graphics.lineStyle(t.lineStyle.thickness,t.lineStyle.color,t.lineStyle.alpha,t.lineStyle.pixelHinting,t.lineStyle.scaleMode,t.lineStyle.caps,t.lineStyle.joints,t.lineStyle.miterLimit),r.graphics.drawArc(e[0],e[1],e[2],e[3],e[4],e[5]),n)for(var i in n)r[i]=n[i];return r},e.createRoundRect=function(e,t,n){var r=new egret.Shape;if(t.beginFill&&r.graphics.beginFill(t.beginFill.color,t.beginFill.alpha),t.lineStyle&&r.graphics.lineStyle(t.lineStyle.thickness,t.lineStyle.color,t.lineStyle.alpha,t.lineStyle.pixelHinting,t.lineStyle.scaleMode,t.lineStyle.caps,t.lineStyle.joints,t.lineStyle.miterLimit),r.graphics.drawRoundRect(e[0],e[1],e[2],e[3],e[4],e[5]),n)for(var i in n)r[i]=n[i];return r},e.removeChild=function(e){e.parent&&e.parent.removeChild(e)},e.clearView=function(e,t){for(isNaN(t)&&(t=-1);e.$children.length>t+1;)e.removeChildAt(t+1);return!0},e}();__reflect(eKit.prototype,"eKit");var baseUrl=GameConfig.getBasicUrl(),app_code=GameConfig.getAppCode(),version=GameConfig.getVersion(),Api=function(){function e(){}return e.post=function(t,n){return __awaiter(this,void 0,void 0,function(){var r=this;return __generator(this,function(i){return[2,new Promise(function(i,o){e.token||o("token为空，请重新登陆");var a=new egret.HttpRequest;a.responseType=egret.HttpResponseType.TEXT,a.open(t,egret.HttpMethod.POST),a.setRequestHeader("Content-Type","application/json"),a.setRequestHeader("Authorization",e.token),a.send(n),a.addEventListener(egret.Event.COMPLETE,function(e){var t=e.currentTarget;i(t.response?JSON.parse(t.response):{})},r),a.addEventListener(egret.IOErrorEvent.IO_ERROR,function(e){o(e)},r)})]})})},e.get=function(t,n){return __awaiter(this,void 0,void 0,function(){var r=this;return __generator(this,function(i){return[2,new Promise(function(i,o){e.token||n||o("token为空，请重新登陆");var a=new egret.HttpRequest;a.responseType=egret.HttpResponseType.TEXT,a.open(t,egret.HttpMethod.GET),a.setRequestHeader("Authorization",e.token),a.send(),a.addEventListener(egret.Event.COMPLETE,function(e){var t=e.currentTarget;i(JSON.parse(t.response))},r),a.addEventListener(egret.IOErrorEvent.IO_ERROR,function(e){o(e)},r)})]})})},e.getToken=function(){return this.token},e.uploadRecords=function(t){return __awaiter(this,void 0,void 0,function(){var n;return __generator(this,function(r){switch(r.label){case 0:return n=!0,t=MD5.createSignObject(t),[4,e.post(e.uploadRecordsPath,t)["catch"](function(e){n=!1})];case 1:return r.sent(),[2,n]}})})},e.getBestRecord=function(t){return __awaiter(this,void 0,void 0,function(){var n;return __generator(this,function(r){switch(r.label){case 0:return n=null,[4,e.get(e.bestRecordPath+"?record_type="+t).then(function(e){n=e})["catch"](function(e){n=null})];case 1:return r.sent(),[2,n]}})})},e.getRankings=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(n){switch(n.label){case 0:return t=null,wx.showLoading({title:"排行榜加载中...",mask:!0,success:function(){},fail:function(){},complete:function(){}}),[4,e.get(e.getRankingsPath+"?record_type=1&page=1&per_page=200").then(function(e){t=e})["catch"](function(e){t=null})];case 1:return n.sent(),wx.hideLoading(),[2,t]}})})},e.getShareUrl=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(n){switch(n.label){case 0:return t="",[4,e.get(e.getShareUrlPath).then(function(e){t=e.url})["catch"](function(e){t=""})];case 1:return n.sent(),[2,t]}})})},e.getTunnel=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(n){switch(n.label){case 0:return t=null,[4,e.get(e.tunnelPath).then(function(e){t=e})["catch"](function(e){t=null})];case 1:return n.sent(),[2,t]}})})},e.postEvent=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){if(!this.doPostEvent)return[2,!0];if(isNaN(t)?t=this.event_type.indexOf(t)+1:this.event_type[t]||(t=0),0==t)throw new Error("事件传值不是预设的值");return e.post(e.postEventPath,{event_type:t}),[2]})})},e.getConfiguration=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(n){switch(n.label){case 0:return t=null,[4,e.get(e.configurationsPath+"?version="+version+"&app_code="+app_code,!0).then(function(e){t=e[0]})["catch"](function(e){console.warn(e)})];case 1:return n.sent(),[2,t]}})})},e.setToken=function(t){e.token=t},e.baseUrl=baseUrl,e.loginPath=baseUrl+"/game-plane/api/v1/auth_login",e.uploadRecordsPath=baseUrl+"/game-plane/api/v1/upload_record",e.bestRecordPath=baseUrl+"/game-plane/api/v2/best_record",e.getRankingsPath=baseUrl+"/game-plane/api/v2/week_rank_list",e.getShareUrlPath=baseUrl+"/game-plane/api/share_url",e.postEventPath=baseUrl+"/game-plane/api/events",e.tunnelPath=baseUrl+"/game-plane/api/tunnel",e.configurationsPath=baseUrl+"/game-plane/api/v1/config",e.event_type=["open","singleGame","uploadScore","replay","normalShare","groupResult","groupRank","reborn"],e.doPostEvent=!1,e}();__reflect(Api.prototype,"Api");var rotateLeft=function(e,t){return e<<t|e>>>32-t},addUnsigned=function(e,t){var n,r,i,o,a;return i=2147483648&e,o=2147483648&t,n=1073741824&e,r=1073741824&t,a=(1073741823&e)+(1073741823&t),n&r?2147483648^a^i^o:n|r?1073741824&a?3221225472^a^i^o:1073741824^a^i^o:a^i^o},F=function(e,t,n){return e&t|~e&n},G=function(e,t,n){return e&n|t&~n},H=function(e,t,n){return e^t^n},I=function(e,t,n){return t^(e|~n)},FF=function(e,t,n,r,i,o,a){return e=addUnsigned(e,addUnsigned(addUnsigned(F(t,n,r),i),a)),addUnsigned(rotateLeft(e,o),t)},GG=function(e,t,n,r,i,o,a){return e=addUnsigned(e,addUnsigned(addUnsigned(G(t,n,r),i),a)),addUnsigned(rotateLeft(e,o),t)},HH=function(e,t,n,r,i,o,a){return e=addUnsigned(e,addUnsigned(addUnsigned(H(t,n,r),i),a)),addUnsigned(rotateLeft(e,o),t)},II=function(e,t,n,r,i,o,a){return e=addUnsigned(e,addUnsigned(addUnsigned(I(t,n,r),i),a)),addUnsigned(rotateLeft(e,o),t)},convertToWordArray=function(e){for(var t,n=e.length,r=n+8,i=(r-r%64)/64,o=16*(i+1),a=Array(o-1),s=0,c=0;n>c;)t=(c-c%4)/4,s=c%4*8,a[t]=a[t]|e.charCodeAt(c)<<s,c++;return t=(c-c%4)/4,s=c%4*8,a[t]=a[t]|128<<s,a[o-2]=n<<3,a[o-1]=n>>>29,a},wordToHex=function(e){var t,n,r="",i="";for(n=0;3>=n;n++)t=e>>>8*n&255,i="0"+t.toString(16),r+=i.substr(i.length-2,2);return r},uTF8Encode=function(e){e=e.replace(/\x0d\x0a/g,"\n");for(var t="",n=0;n<e.length;n++){var r=e.charCodeAt(n);128>r?t+=String.fromCharCode(r):r>127&&2048>r?(t+=String.fromCharCode(r>>6|192),t+=String.fromCharCode(63&r|128)):(t+=String.fromCharCode(r>>12|224),t+=String.fromCharCode(r>>6&63|128),t+=String.fromCharCode(63&r|128))}return t},MD5=function(){function e(){}return e.createNonceStr=function(e){e||(e=16);for(var t="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",n="",r=0;e>r;r++)n+=t[Math.floor(62*Math.random())];return n},e.createSignObject=function(e){var t="",n=this.createNonceStr();e.nonce_str=n;var r=[];for(var i in e)r.push(i+"="+e[i]);return t=r.sort(function(e,t){return e>t?1:-1}).join("&")+"&key="+GameConfig.getKey(),console.log(t),e.nonce_str=n,e.sign=this.encode(t).toUpperCase(),e},e.encode=function(e){var t,n,r,i,o,a,s,c,u,l=Array(),d=7,h=12,f=17,g=22,p=5,_=9,v=14,w=20,y=4,m=11,S=16,x=23,b=6,T=10,C=15,R=21;for(e=uTF8Encode(e),l=convertToWordArray(e),a=1732584193,s=4023233417,c=2562383102,u=271733878,t=0;t<l.length;t+=16)n=a,r=s,i=c,o=u,a=FF(a,s,c,u,l[t+0],d,3614090360),u=FF(u,a,s,c,l[t+1],h,3905402710),c=FF(c,u,a,s,l[t+2],f,606105819),s=FF(s,c,u,a,l[t+3],g,3250441966),a=FF(a,s,c,u,l[t+4],d,4118548399),u=FF(u,a,s,c,l[t+5],h,1200080426),c=FF(c,u,a,s,l[t+6],f,2821735955),s=FF(s,c,u,a,l[t+7],g,4249261313),a=FF(a,s,c,u,l[t+8],d,1770035416),u=FF(u,a,s,c,l[t+9],h,2336552879),c=FF(c,u,a,s,l[t+10],f,4294925233),s=FF(s,c,u,a,l[t+11],g,2304563134),a=FF(a,s,c,u,l[t+12],d,1804603682),u=FF(u,a,s,c,l[t+13],h,4254626195),c=FF(c,u,a,s,l[t+14],f,2792965006),s=FF(s,c,u,a,l[t+15],g,1236535329),a=GG(a,s,c,u,l[t+1],p,4129170786),u=GG(u,a,s,c,l[t+6],_,3225465664),c=GG(c,u,a,s,l[t+11],v,643717713),s=GG(s,c,u,a,l[t+0],w,3921069994),a=GG(a,s,c,u,l[t+5],p,3593408605),u=GG(u,a,s,c,l[t+10],_,38016083),c=GG(c,u,a,s,l[t+15],v,3634488961),s=GG(s,c,u,a,l[t+4],w,3889429448),a=GG(a,s,c,u,l[t+9],p,568446438),u=GG(u,a,s,c,l[t+14],_,3275163606),c=GG(c,u,a,s,l[t+3],v,4107603335),s=GG(s,c,u,a,l[t+8],w,1163531501),a=GG(a,s,c,u,l[t+13],p,2850285829),u=GG(u,a,s,c,l[t+2],_,4243563512),c=GG(c,u,a,s,l[t+7],v,1735328473),s=GG(s,c,u,a,l[t+12],w,2368359562),a=HH(a,s,c,u,l[t+5],y,4294588738),u=HH(u,a,s,c,l[t+8],m,2272392833),c=HH(c,u,a,s,l[t+11],S,1839030562),s=HH(s,c,u,a,l[t+14],x,4259657740),a=HH(a,s,c,u,l[t+1],y,2763975236),u=HH(u,a,s,c,l[t+4],m,1272893353),c=HH(c,u,a,s,l[t+7],S,4139469664),s=HH(s,c,u,a,l[t+10],x,3200236656),a=HH(a,s,c,u,l[t+13],y,681279174),u=HH(u,a,s,c,l[t+0],m,3936430074),c=HH(c,u,a,s,l[t+3],S,3572445317),s=HH(s,c,u,a,l[t+6],x,76029189),a=HH(a,s,c,u,l[t+9],y,3654602809),u=HH(u,a,s,c,l[t+12],m,3873151461),c=HH(c,u,a,s,l[t+15],S,530742520),s=HH(s,c,u,a,l[t+2],x,3299628645),a=II(a,s,c,u,l[t+0],b,4096336452),u=II(u,a,s,c,l[t+7],T,1126891415),c=II(c,u,a,s,l[t+14],C,2878612391),s=II(s,c,u,a,l[t+5],R,4237533241),a=II(a,s,c,u,l[t+12],b,1700485571),u=II(u,a,s,c,l[t+3],T,2399980690),c=II(c,u,a,s,l[t+10],C,4293915773),s=II(s,c,u,a,l[t+1],R,2240044497),a=II(a,s,c,u,l[t+8],b,1873313359),u=II(u,a,s,c,l[t+15],T,4264355552),c=II(c,u,a,s,l[t+6],C,2734768916),s=II(s,c,u,a,l[t+13],R,1309151649),a=II(a,s,c,u,l[t+4],b,4149444226),u=II(u,a,s,c,l[t+11],T,3174756917),c=II(c,u,a,s,l[t+2],C,718787259),s=II(s,c,u,a,l[t+9],R,3951481745),a=addUnsigned(a,n),s=addUnsigned(s,r),c=addUnsigned(c,i),u=addUnsigned(u,o);var F=wordToHex(a)+wordToHex(s)+wordToHex(c)+wordToHex(u);return F.toLowerCase()},e}();__reflect(MD5.prototype,"MD5");var Mp3=function(){function e(){}return e.loadEventSound=function(){this.eventSoundList=SoundRes.eventSoundList.map(function(e){return e.context=wx.createInnerAudioContext(),e.context.src=e.path,e})},e.switchBgm=function(e){var t=this;this.bgm&&this.bgm.pause(),this.eventSoundList.map(function(n){n.name==e&&(t.bgm=n.context)}),console.log(this.bgm),this.bgm&&(this.bgm.loop=!0),this.bgm&&!this.mute&&this.bgm.play()},e.playBGM=function(){this.bgm&&!this.mute&&this.bgm.play()},e.stopBGM=function(){this.bgm&&this.bgm.pause()},e.playEvent=function(e){var t=this;this.eventSoundList.map(function(n){n.name==e&&(n.context.stop(),!t.mute&&n.context.play())})},e.bgm=null,e.eventSoundList=null,e.mute=!1,e}();__reflect(Mp3.prototype,"Mp3");var Records=function(){function e(){}return e.getWeekScore=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n;return __generator(this,function(r){switch(r.label){case 0:return e=Utils.getWeekTime(),t={record_type:1},n=0,[4,Api.getBestRecord(1).then(function(e){n=e.week_best})];case 1:return r.sent(),this.weekScore=n,[2,n]}})})},e.getHistoryScore=function(){return __awaiter(this,void 0,void 0,function(){var e,t;return __generator(this,function(n){switch(n.label){case 0:return e={record_type:1},t=0,[4,Api.getBestRecord(1).then(function(e){t=e.history_best})];case 1:return n.sent(),this.historyScore=t,[2,t]}})})},e.refreshWorldRanking=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return e=null,[4,Api.getRankings().then(function(t){e=t})];case 1:return t.sent(),this.worldRankings=e,[2,e]}})})},e.getRankings=function(){return JSON.parse(JSON.stringify(this.worldRankings))},e.getScore=function(){return this.score},e.updateScore=function(e){this.score=e||0},e.updateRecordType=function(e){this.record_type=e||0},e.uploadScore=function(){return __awaiter(this,void 0,void 0,function(){var t,n=this;return __generator(this,function(r){switch(r.label){case 0:return t={score:this.score||0,record_type:this.record_type||1},[4,Api.uploadRecords(t).then(function(t){return __awaiter(n,void 0,void 0,function(){var n;return __generator(this,function(r){switch(r.label){case 0:return n=!t,n?[4,e.updateScore()]:[3,2];case 1:n=r.sent(),r.label=2;case 2:return[2]}})})})];case 1:return r.sent(),[4,WxKit.uploadScore(this.score||0)];case 2:return r.sent(),[2,!0]}})})},e.score=62,e}();__reflect(Records.prototype,"Records");var Main=function(e){function t(){var t=e.call(this)||this;return t.addEventListener(egret.Event.ADDED_TO_STAGE,t.createChildren,t),t}return __extends(t,e),t.prototype.createChildren=function(){egret.lifecycle.addLifecycleListener(function(e){}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()},this.runGame()["catch"](function(e){console.log(e)})},t.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return[4,this.loadResource()];case 1:return t.sent(),this.createGameScene(),[4,RES.getResAsync("description_json")];case 2:return e=t.sent(),[2]}})})},t.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var e,t;return __generator(this,function(n){switch(n.label){case 0:return n.trys.push([0,3,,4]),e=new LoadingUI,this.stage.addChild(e),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return n.sent(),[4,RES.loadGroup("preload",0,e)];case 2:return n.sent(),this.stage.removeChild(e),[3,4];case 3:return t=n.sent(),console.error(t),[3,4];case 4:return[2]}})})},t.prototype.createGameScene=function(){var e=this;GameConfig.setStageWidthHeight(this.stage),VersionCtrl.refreshVersionCtrl();var t=eKit.createBitmapByName("bg_jpg",{width:GameConfig.getWidth(),height:GameConfig.getHeight(),x:0,y:0,touchEnabled:!0});this.addChild(t);var n=eKit.createSprite({x:20,y:20});this.addChild(n);var r=eKit.createRect([0,0,120,60],{beginFill:{color:10062079,alpha:1}},{touchEnabled:!0});n.addChild(r),n.addChild(eKit.createText("切换音乐",{width:120,height:60,size:20,textAlign:"center",verticalAlign:"middle"})),r.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){Mp3.switchBgm("bgm_game")},this);var i=eKit.createSprite({x:20,y:100});this.addChild(i);var o=eKit.createRect([0,0,120,60],{beginFill:{color:10062079,alpha:1}},{touchEnabled:!0});i.addChild(o),i.addChild(eKit.createText("调用事件音乐",{width:120,height:60,size:20,textAlign:"center",verticalAlign:"middle"})),o.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){Mp3.playEvent("hit")},this);var a=eKit.createSprite({x:20,y:180});this.addChild(a);var s=eKit.createRect([0,0,120,60],{beginFill:{color:10062079,alpha:1}},{touchEnabled:!0});a.addChild(s),a.addChild(eKit.createText("触发粒子",{width:120,height:60,size:20,textAlign:"center",verticalAlign:"middle"})),s.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){return __awaiter(e,void 0,void 0,function(){var e;return __generator(this,function(t){return e=new particle.GravityParticleSystem(RES.getRes("boom_png"),RES.getRes("boom_json")),e.start(50),this.addChild(e),[2]})})},this);var c=eKit.createSprite({x:20,y:260});this.addChild(c);var u=eKit.createRect([0,0,120,60],{beginFill:{color:10062079,alpha:1}},{touchEnabled:!0});c.addChild(u),c.addChild(eKit.createText("清空按钮",{width:120,height:60,size:20,textAlign:"center",verticalAlign:"middle"})),u.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){return __awaiter(e,void 0,void 0,function(){return __generator(this,function(e){return eKit.clearView(this,0),[2]})})},this);var l=null,d=eKit.createSprite({x:20,y:340});this.addChild(d);var h=eKit.createRect([0,0,120,60],{beginFill:{color:10062079,alpha:1}},{touchEnabled:!0});d.addChild(h),d.addChild(eKit.createText("显示BANNER广告",{width:120,height:60,size:20,textAlign:"center",verticalAlign:"middle"})),h.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){return __awaiter(e,void 0,void 0,function(){return __generator(this,function(e){return!l&&(l=WxKit.showBannerAd("")),[2]})})},this);var f=eKit.createSprite({x:20,y:420});this.addChild(f);var g=eKit.createRect([0,0,120,60],{beginFill:{color:10062079,alpha:1}},{touchEnabled:!0});f.addChild(g),f.addChild(eKit.createText("隐藏BANNER广告",{width:120,height:60,size:20,textAlign:"center",verticalAlign:"middle"})),g.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){return __awaiter(e,void 0,void 0,function(){return __generator(this,function(e){return l&&"function"==typeof l.hide&&(l.hide(),l.destory(),l=null),[2]})})},this);var p=eKit.createSprite({x:20,y:500});this.addChild(p);var _=eKit.createRect([0,0,120,60],{beginFill:{color:10062079,alpha:1}},{touchEnabled:!0});p.addChild(_),p.addChild(eKit.createText("显示视频广告",{width:120,height:60,size:20,textAlign:"center",verticalAlign:"middle"})),_.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){return __awaiter(e,void 0,void 0,function(){return __generator(this,function(e){return WxKit.showVideoAd("",function(){wx.showToast({title:"观看广告成功",icon:"success",image:null})},function(){wx.showToast({title:"观看广告失败",icon:null,image:null})}),[2]})})},this);var v=eKit.createSprite({x:160,y:20});this.addChild(v);var w=eKit.createRect([0,0,120,60],{beginFill:{color:10062079,alpha:1}},{touchEnabled:!0});v.addChild(w),v.addChild(eKit.createText("调用登录",{width:120,height:60,size:20,textAlign:"center",verticalAlign:"middle"})),v.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){return __awaiter(e,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,WxKit.login()];case 1:return e.sent(),wx.hideLoading(),WxKit.setDefaultShare(),WxKit.setOnShowRule(),[2]}})})},this);var y=eKit.createSprite({x:160,y:100});this.addChild(y);var m=eKit.createRect([0,0,120,60],{beginFill:{color:10062079,alpha:1}},{touchEnabled:!0});y.addChild(m),y.addChild(eKit.createText("调用分享",{width:120,height:60,size:20,textAlign:"center",verticalAlign:"middle"})),y.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){WxKit.shareGame("normalShare","我就试试分享","")},this);var S=eKit.createSprite({x:160,y:180});this.addChild(S);var x=eKit.createRect([0,0,120,60],{beginFill:{color:10062079,alpha:1}},{touchEnabled:!0});S.addChild(x),S.addChild(eKit.createText("好友排行榜",{width:120,height:60,size:20,textAlign:"center",verticalAlign:"middle"})),x.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){return __awaiter(e,void 0,void 0,function(){var e;return __generator(this,function(t){return e=WxKit.linkOpenData({}),this.addChild(e),[2]})})},this),Mp3.loadEventSound(),Mp3.switchBgm("bgm_default")},t}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");var Ws=function(){function e(){}return e}();__reflect(Ws.prototype,"Ws");var PLATFORM=new WxPlatform,WxKit=function(){function e(){}return e.login=function(){return __awaiter(this,void 0,void 0,function(){var t,n,r,i=this;return __generator(this,function(o){switch(o.label){case 0:return t=null,n=null,r=null,[4,PLATFORM.login().then(function(e){t=e.code})["catch"](function(e){console.warn(e)})];case 1:return o.sent(),[4,PLATFORM.getUserInfo().then(function(n){return __awaiter(i,void 0,void 0,function(){var i;return __generator(this,function(o){switch(o.label){case 0:return i=JSON.parse(JSON.stringify(n)),e.iv=i.iv,e.enctypecode=i.encryptedData,[4,PLATFORM.auth(t,i.iv,i.encryptedData).then(function(e){r=JSON.parse(JSON.stringify(e)),Api.setToken(r.data.token),UserData.setUserData(r.data),console.log("login_success")})["catch"](function(e){console.warn(e)})];case 1:return o.sent(),console.warn("get_user_info_success"),console.log(i),[2]}})})})["catch"](function(o){return __awaiter(i,void 0,void 0,function(){var i,o=this;return __generator(this,function(a){switch(a.label){case 0:return"function"==typeof wx.createUserInfoButton?[3,2]:[4,e.reAuth().then(function(e){return __awaiter(o,void 0,void 0,function(){return __generator(this,function(i){switch(i.label){case 0:return n=JSON.parse(JSON.stringify(e)),[4,PLATFORM.auth(t,n.iv,n.encryptedData).then(function(e){r=JSON.parse(JSON.stringify(e)),Api.setToken(r.data.token),UserData.setUserData(r.data),console.log("login_success")})["catch"](function(e){console.warn(e)})];case 1:return i.sent(),[2]}})})})];case 1:return a.sent(),[3,3];case 2:wx.hideLoading(),i=wx.createUserInfoButton(WxLoginButton.btnSkin),i.show(),i.onTap(function(n){return __awaiter(o,void 0,void 0,function(){return __generator(this,function(o){switch(o.label){case 0:return console.log(n),"getUserInfo:ok"!=n.errMsg?[3,2]:(e.iv=n.iv,e.enctypecode=n.encryptedData,[4,PLATFORM.auth(t,e.iv,e.enctypecode).then(function(e){r=JSON.parse(JSON.stringify(e)),Api.setToken(r.data.token),UserData.setUserData(r.data),console.log("login_success")})["catch"](function(e){console.warn(e)})]);case 1:return o.sent(),i.hide(),[3,3];case 2:return[2,!1];case 3:return[2]}})})}),a.label=3;case 3:return[2]}})})})];case 2:return o.sent(),[2,r]}})})},e.reAuth=function(){return __awaiter(this,void 0,void 0,function(){var t=this;return __generator(this,function(n){return wx.hideLoading(),[2,new Promise(function(n,r){PLATFORM.showAuthModal().then(function(r){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return r.authSetting["scope.userInfo"]?[4,PLATFORM.getUserInfo().then(function(e){n(e)})]:[3,2];case 1:return t.sent(),[3,4];case 2:return[4,e.reAuth().then(function(e){n(e)})];case 3:t.sent(),t.label=4;case 4:return[2]}})})})})]})})},e.setDefaultShare=function(){console.log("set_default_share"),wx.showShareMenu({withShareTicket:!0,success:function(e){console.log("setting_success"),console.log(e)},fail:function(e){console.warn(e)}}),wx.onShareAppMessage(function(){return{title:GameConfig.getShareTitle()||"",imageUrl:GameConfig.getShareImg()||""}})},e.shareGame=function(e,t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){switch(r.label){case 0:return e||(e="normalShare"),t||(t=GameConfig.getShareTitle()),n||(n=GameConfig.getShareImg()),"get"!=n?[3,2]:[4,Api.getShareUrl()];case 1:n=r.sent(),r.label=2;case 2:return[2,new Promise(function(r,i){wx.shareAppMessage({title:t,imageUrl:n,query:e.match("group")?"groupRank=1":"",success:function(e){r(e)},fail:function(e){r(null)}})})]}})})},e.rebornGame=function(t,n){return __awaiter(this,void 0,void 0,function(){var r;return __generator(this,function(i){switch(i.label){case 0:return r=!1,[4,e.shareGame("reborn",t,n).then(function(e){r=!!e})];case 1:return i.sent(),[2,r]}})})},e.linkOpenData=function(e,t,n){var r={isDisplay:"true",token:Api.getToken(),userInfo:UserData.getUserData()};for(var i in e)r[i]=e[i];var o=new egret.Sprite,a=wx.getOpenDataContext(),s=new egret.BitmapData(window.sharedCanvas);s.$deleteSource=!1;var c=new egret.Texture;c._setBitmapData(s);var u;return u=new egret.Bitmap(c),u.width=t||GameConfig.getWidth(),u.height=n||GameConfig.getHeight(),u.name="openData",o.addChild(u),egret.startTick(function(e){return egret.WebGLUtils.deleteWebGLTexture(s.webGLTexture),s.webGLTexture=null,!1},this),a.postMessage(r),console.log("link_done"),o},e.uploadScore=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,PLATFORM.setKVData({score:e+"",date:Utils.getNowDate()}).then(function(e){})];case 1:return t.sent(),[2,!0]}})})},e.setOnShowRule=function(){wx.onShow(function(){Mp3.playBGM()})},e.showVideoAd=function(t,n,r){var i=this;return t?"function"!=typeof wx.createRewardedVideoAd?void wx.showModal({title:"系统提示",content:"您的微信版本太低，暂时无法获取广告",showCancel:!1,cancelText:"",confirmText:"确定",success:function(){n()}}):(this.video_ads[t]=wx.createRewardedVideoAd({adUnitId:t}),this.current_video_ad_id=t,Mp3.stopBGM(),this.video_ads[t].load().then(function(){i.video_ads[t].show()})["catch"](function(e){wx.showModal({title:"系统提示",content:"暂时无法获取广告",showCancel:!1,cancelText:"",confirmText:"确定",success:function(){i.current_video_ad_id==t&&n()&&(i.current_video_ad_id="")
}})}),void this.video_ads[t].onClose(function o(i){!i||i.isEnded?e.current_video_ad_id==t&&n()&&(e.current_video_ad_id=""):r&&e.current_video_ad_id==t&&r()&&(e.current_video_ad_id=""),Mp3.playBGM(),e.video_ads[t].offClose(o)})):void wx.showModal({title:"系统提示",content:"请填入ad_id",showCancel:!1,cancelText:"",confirmText:"确定",success:function(){r()}})},e.showBannerAd=function(e){if(!e)return wx.showModal({title:"系统提示",content:"请填入ad_id",showCancel:!1,cancelText:"",confirmText:"确定",success:function(){}}),null;var t="function"==typeof wx.createBannerAd?wx.createBannerAd({adUnitId:e,style:{left:0,top:0,width:350}}):null;if(t){t.show();var n=wx.getSystemInfoSync(),r=n.screenWidth,i=n.screenHeight;t.onResize(function(e){t.style.top=i-t.style.realHeight}),t.style.width=r}return t},e.iv="",e.enctypecode="",e.video_ads={},e.current_video_ad_id="",e}();__reflect(WxKit.prototype,"WxKit");var WxLoginButton=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.btnSkin={type:"text",text:"开 始 游 戏",style:{left:22,bottom:160,width:360,height:80,lineHeight:80,backgroundColor:"rgba(160,180,240,0.7)",color:"#ffffff",textAlign:"center",fontSize:32,borderRadius:6}},t}(Object);__reflect(WxLoginButton.prototype,"WxLoginButton");var LoadingUI=function(e){function t(){var t=e.call(this)||this;return t.createView(),t}return __extends(t,e),t.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},t.prototype.onProgress=function(e,t){this.textField.text="Loading..."+e+"/"+t},t}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var partRes=function(){function e(){}return e.initList=function(){this.list.map(function(e){e.texture=RES.getRes(e.texture_path),e.json=RES.getRes(e.json_path)})},e.getRes=function(e){var t={texture:null,json:null};return this.list.map(function(n){n.name==e&&(t=n)}),t},e.list=[{name:"boom",texture_path:"boom_png",texture:null,json_path:"boom_json",json:null},{name:"hit",texture_path:"hit_png",texture:null,json_path:"hit_json",json:null},{name:"flame",texture_path:"flame_png",texture:null,json_path:"flame_json",json:null}],e}();__reflect(partRes.prototype,"partRes");var SoundRes=function(){function e(){}return e.eventSoundList=[{name:"bgm_default",path:"resource/assets/mp3/bgm_default.mp3"},{name:"bgm_game",path:"resource/assets/mp3/bgm_game2.mp3"},{name:"hit",path:"resource/assets/mp3/hit.mp3"}],e}();__reflect(SoundRes.prototype,"SoundRes");var UserData=function(){function e(){}return e.getOpenId=function(){return this.openId},e.getId=function(){return this.id},e.getUserData=function(){return JSON.parse(JSON.stringify(this.userInfo))},e.setUserData=function(e){this.avatar_url=e.avatar_url,this.openId=e.open_id,this.nickname=e.nickname,this.gender=e.gender,this.id=e.id,this.userInfo=e},e}();__reflect(UserData.prototype,"UserData");var VersionCtrl=function(){function e(){}return e.refreshVersionCtrl=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return e=this,[4,Api.getConfiguration()];case 1:return e.configuration=t.sent(),[2]}})})},e.queryConfig=function(e){return this.configuration[e]},e}();__reflect(VersionCtrl.prototype,"VersionCtrl"),window.Main=Main;